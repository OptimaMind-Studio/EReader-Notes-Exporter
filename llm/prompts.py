#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
LLM Prompt 模板
包含学习大纲生成和概念提取相关的 Prompt 模板
"""

OUTLINE_PROMPT_TEMPLATE = """你是一个总结读书笔记的助手，我会给你如下的内容：

【划线笔记】：指的是我在读书时，着重划线得到的重点本文，来自于原书的文本。注重，在划线笔记中，还包含章节的标题。区别方法是划线的文本有bullet point的标记，而章节标题没有。组织形式是章节+多条划线的文本+下一个章节，以此类推。

注意，划线笔记不一定都是重点，或者必然包含全书的重要概念和结论。因为是人工标注的，可能有一些噪音，受到阅读时的认知或者状态的影响。例如刚读书的时候，没有对整本书的global view。


【点评笔记】：指的是我在读书时，有部分划线内容，我结合自己的想法或者经历，做的评论。有些比较有深度，文本长一些，有些是短一些的快速评论没有上下文。

----
基于上面的信息，我希望你总结出结构化的读书笔记，有如下要求：

1. 你输出的格式，必须是markdown形式采用bullet points多层缩进的形式，方便我展开成mind map。

2. 你输出的内容必须是结构化的，并且bullet points 的多层缩进，是有正确清晰的层级逻辑。



   
具体步骤如下：

第一步，多个层级【概念块】的生成，具体来说，
首先，整体理解【划线笔记】、【点评笔记】的全部原文部分，并且用自己的话高度概括，整理出多个独立的【概念块】。

然后，采取树形结构，将【概念块】按照相互之间的逻辑，组织起来，最终形成一个大型的markdown文本，称为【层级概念块】。

注意！！！【层级概念块】简单讲【概念块】并列在一起，而是多层的层级结构的。意味着某些概念块，属于其他概念块的子集。

第二步，提取【概念块】中的【关键概念词】，要求尽量基于原书的【划线笔记】，高度概括和总结【关键概念词】的定义。用表格的形式输出，第一列是概念词，第二列是对应【层级概念块】的编号，第三列是范畴，第四列是概念的解释。

第三步，提炼【个人思考内化】：筛选【点评笔记】中的精华，请将点评笔记与原文结合，提炼为以下两个独立板块：

1. 深度评价与哲学升华（Meta-Thinking）：
- 主要是读者对书中观点的点评和深入思考，在形而上层面的延伸（（和我的过往经历无关的）。
- 例如哲学内涵、逻辑架构、认知世界层面的，认知上的新结构、解构。
2. 自身经历映射与生命实践（Self-Reflection）：
- 筛选笔记中结合读者自身经历（如家庭、职场、心态变化、等等）的启发。
- 总结书中观点如何具体地解决了读者的现实困惑，或如何转化为可操作的个人生活准则（强调实操与共鸣）。

要求：尽可能不遗漏任何点评，但是多次出现的相似观点，可以重点分析！！

---
输出的内容和顺序：
1. 请依次输出【层级概念块】、【关键概念词】、【个人思考内化】，转化为对应格式的HTML文本，注意不要有重复的内容。
2. 层级概念块需要用header来进行组织，而不是都在一整个嵌套的bullet points中。而且header需要有数字标号来体现层级关系。
3. 【层级概念块】、【关键概念词】尽量多得引用原文内容（但也不要只是原文的罗列，而是用自己的话把它们串起来，而且需要有逻辑的串起来，可以起小标题、或者写总结的文字）
4. 如果引用原文，就用加粗的斜体字来标记。如果没有引用原文，就不要用加粗的斜体字。
5. 在语言方面，请用中英文解释，意思是，每一句中文后面，都要跟着对应的英文翻译，注意不要遗漏，所以标题也是需要有英文翻译的。
6. 不要无用的空行，字体丰富，排版美观，文字不要超出当前页面宽度, 用h3-h6标签来组织内容，不要用ul-li标签。
7. 最终返回的格式是一个合法的html文本，不要有其他多余的内容，不要有未转义的控制字符。

----
下面是具体内容：
【划线笔记】：{{划线笔记}}
【点评笔记】：{{点评笔记}}}"""

# 概念提取相关 Prompt 模板

EXTRACT_CONCEPTS_PROMPT_TEMPLATE = """请根据以下文本，找出在这个领域（{{domain}}）中的概念词汇。可能有多個概念词。

要求：
1. 只返回概念词，不要返回定义
2. 每个概念词一行
3. 如果找不到概念词，返回"无"
4. 返回出现频率最高的概念词（不超过6个），这些文本是围绕这个词所重点讨论的，你不可以随便找几个词敷衍。
5. 这个概念词并不能是大众所知道的，而是这个领域特有的。

文本：
{{text_content}}"""

DEDUPLICATE_CONCEPTS_PROMPT_TEMPLATE = """请对以下概念词列表进行去重。去重不仅仅是去除完全相同的词，还要从概念和形式上判断：
1. 概念相同但表述不同的词应该合并为一个
2. 形式相似但概念不同的词应该保留
3. 只返回去重后的概念词列表，每行一个

概念词列表：
{{concepts_text}}"""

GET_CONCEPT_CATEGORY_PROMPT_TEMPLATE = """请告诉我"{{concept}}"这个概念在"{{domain}}"这个领域中的子分类是什么？

只返回子分类名称，不要其他内容。如果无法确定，返回"其他"。"""

GET_CONCEPT_DEFINITION_HTML_PROMPT_TEMPLATE = """请根据以下文本，为"{{concept}}"这个概念生成一个 HTML 格式的详细解释。

要求：
1. 这个列表中的句子**并不是每句话都和"{{concept}}"这个概念相关**，请**依次判断是否与"{{concept}}"这个概念相关**
2. **包含关键词"{{concept}}"的句子肯定是相关的**，必须使用
3. 对于其他句子，请**只使用相关的句子**，剔除不相关的句子，不要强行把所有句子都放到 HTML 中
4. **内容来源**：尽量多使用输入列表中提供的原文内容（占据到70%以上），用你自己的知识库，来把这些原文内容串联，在内容和逻辑上完整。
5. **不要发散**：你增加的内容是为了提高可读性，容易理解，而不是发散太多内容。所以你添加的内容占比要少于30%。
6. 中英文混合解释，意思是，每一句中文后面，要跟着一句英文翻译，包括标题也是需要有英文翻译的。
7. 内容像课件一样，可读性很高，要求有outline的层次来体现逻辑性，有样式和排版，以及适当用表格和diagram来体现概念的结构和关系。
8. 当引用原文原话时，使用 <strong><u>原文内容</u></strong> 标记（加粗加下划线）
9. 使用标准的 HTML 标签，如 <h3>, <p>, <strong>, <u> 等
10. 只返回 HTML 内容，不要有其他多余的内容

领域：{{domain}}
概念：{{concept}}

相关文本：
{{sentences_text}}"""

GET_SHORT_DEFINITION_PROMPT_TEMPLATE = """请用一句话简洁地解释"{{concept}}"这个概念（在"{{domain}}"领域中）。

要求：
1. 纯文本，不要 HTML 标签
2. 30个字符以内
3. 只返回定义，不要其他内容"""

# 学习指南生成相关 Prompt 模板

GUIDEBOOK_EXPLANATION_PROMPT_TEMPLATE = """
角色设定： 你现在是一位博学且极具耐心的私人导师，擅长将复杂的学术概念通俗化。你的任务是协助我阅读一本我并不熟悉的领域书籍。
任务场景： 我会为你提供书中的划线句子、核心观点或结论。由于我是该领域的初学者，我往往只能看到结论，却看不透背后的逻辑支撑。请你针对我提供的每一段内容，回答我心中的疑惑：“为什么作者这句话是对的？”以及“这句话背后到底在表达什么？”
回复要求（请按此结构执行）：
标题《书名》 -- 阅读助手
0. 核心概念和定义：（用一个表格来展示）
| 概念 | 定义 |
| --- | --- |
| 概念1 | 定义1 |
| 概念2 | 定义2 |
| ... | ... |

0.0 原文：（markText的原文）
1. 问题1（写具体的简短标题来总结问题）
1.1 学生问：
2.2 原理：（用1个关键词或短语，来最精准简单地回答）
3.3 解释：（老师详细解释原理和背后的逻辑，用bullet points来展示））

最多2个问题，不要超过2个问题。

注意！！！！ 在html中，要按照标题的标号来组织header的层级关系。
---

例子

原文： 近三分之一的美元银行系统位于美国境外，其中包括中国各银行持有的1万亿美元资产。

学生问： 美元不在美国，那在哪？

原理： 离岸美元（Eurodollar）。

老师解释： 想象一下，一个中国公司卖衣服给德国公司，双方可能都觉得用人民币或欧元麻烦，于是商定用美元结算。这笔钱存在中国的银行里，但它是美元。这就是“不在美国境内的美元”。这个系统巨大无比，甚至超过了美国本土的规模。
---

输入信息：
1. 领域：{{domain}}
2. 书名：{{title}}
3. 划线原文：{{mark_text}}

---
格式要求：
最终返回的格式是一个合法的html文本，不要有其他多余的内容，不要有未转义的控制字符。
需要用header来进行组织，而不是都在一整个嵌套的bullet points中。而且header需要有数字标号来体现层级关系。
如果引用原文，就用加粗的斜体字来标记（使用 <strong><em>原文内容</em></strong> 或 <b><i>原文内容</i></b>）。如果没有引用原文，就不要用加粗的斜体字。
在语言方面，请用中英文解释，意思是，每一句中文后面，都要跟着对应的英文翻译，注意不要遗漏，所以标题也是需要有英文翻译的。
不要无用的空行，字体丰富，排版美观，文字不要超出当前页面宽度, 用h3-h6标签来组织内容，不要用ul-li标签。
"""

